<h2>{{ 'appointment.newAppointmentTitle' | translate }}</h2>
<form #appointmentForm="ngForm" (submit)="onSubmit()" class="form">

  <!-- Información básica de la cita -->
  <div class="form-section">
    <h3 class="section-title">{{ 'appointment.basicInfoTitle' | translate }}</h3>

    <mat-form-field class="input-full-width">
      <mat-label>{{ 'appointment.appointmentNameLabel' | translate }}</mat-label>
      <input matInput
             [(ngModel)]="appointment.appointmentName"
             name="appointmentName"
             placeholder="{{ 'appointment.appointmentNamePlaceholder' | translate }}"
             type="text"
             required
             maxlength="100">
      <mat-hint>{{ 'appointment.nameHint' | translate }}</mat-hint>
    </mat-form-field>
  </div>

  <!-- DATE FORM -->
  <div class="form-section">
    <h3 class="section-title">{{ 'appointment.dateTimeTitle' | translate }}</h3>

    <!-- START DATE AND TIME -->
    <div class="date-time-row">
      <mat-form-field class="date-field" appearance="fill">
        <mat-label>{{ 'appointment.startDateLabel' | translate }}</mat-label>
        <input matInput
               [matDatepicker]="startDatePicker"
               [(ngModel)]="appointment.startDateAppointment"
               name="startDateAppointment"
               placeholder="MM/DD/YYYY"
               required
               [min]="minDate"
               [max]="maxDate">
        <mat-datepicker-toggle matIconSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #startDatePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field class="time-field">
        <mat-label>{{ 'appointment.startTimeLabel' | translate }}</mat-label>
        <mat-select [(ngModel)]="appointment.startTimeAppointment" name="startTimeAppointment" required>
          <mat-option *ngFor="let time of timeSlots" [value]="time">
            {{ time }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- END DATE AND TIME -->
    <div class="date-time-row">
      <mat-form-field class="date-field" appearance="fill">
        <mat-label>{{ 'appointment.endDateLabel' | translate }}</mat-label>
        <input matInput
               [matDatepicker]="endDatePicker"
               [(ngModel)]="appointment.endDateAppointment"
               name="endDateAppointment"
               placeholder="MM/DD/YYYY"
               required
               [min]="appointment.startDateAppointment || minDate"
               [max]="maxDate">
        <mat-datepicker-toggle matIconSuffix [for]="endDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #endDatePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field class="time-field">
        <mat-label>{{ 'appointment.endTimeLabel' | translate }}</mat-label>
        <mat-select [(ngModel)]="appointment.endTimeAppointment" name="endTimeAppointment" required>
          <mat-option *ngFor="let time of timeSlots" [value]="time">
            {{ time }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <!-- Estado con selector visual -->
  <div class="form-section">
    <h3 class="section-title">{{ 'appointment.statusTitle' | translate }}</h3>

    <mat-form-field appearance="fill" class="input-full-width">
      <mat-label>{{ 'appointment.statusLabel' | translate }}</mat-label>
      <mat-select [(ngModel)]="appointment.status" name="status" required>
        <mat-option value="SCHEDULED">
          <mat-icon>schedule</mat-icon>
          {{ 'appointment.status.scheduled' | translate }}
        </mat-option>
        <mat-option value="CONFIRMED">
          <mat-icon>check_circle</mat-icon>
          {{ 'appointment.status.confirmed' | translate }}
        </mat-option>
        <mat-option value="PENDING">
          <mat-icon>hourglass_empty</mat-icon>
          {{ 'appointment.status.pending' | translate }}
        </mat-option>
        <mat-option value="CANCELLED">
          <mat-icon>cancel</mat-icon>
          {{ 'appointment.status.cancelled' | translate }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Selección de mascota, tarifa y veterinario -->
  <div class="form-section">
    <h3 class="section-title">{{ 'appointment.assignmentTitle' | translate }}</h3>

    <mat-form-field appearance="fill" class="input-full-width">
      <mat-label>{{ 'appointment.petLabel' | translate }}</mat-label>
      <mat-select name="petId" [(ngModel)]="appointment.petId" required>
        <mat-option [value]="0" disabled>{{ 'appointment.noSelectedPet' | translate }}</mat-option>
        <mat-option *ngFor="let option of optionsPet" [value]="option.id">
          <div class="select-option-with-info">
            <span class="option-name">{{ option.petName }}</span>
            <span class="option-detail">{{ option.animalBreed }} - {{ option.ownerName }}</span>
          </div>
        </mat-option>
      </mat-select>
      <mat-hint>{{ 'appointment.petHint' | translate }}</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="fill" class="input-full-width">
      <mat-label>{{ 'appointment.tariffLabel' | translate }}</mat-label>
      <mat-select name="tariffId" [(ngModel)]="appointment.tariffId" required>
        <mat-option [value]="0" disabled>{{ 'appointment.noSelectedTariff' | translate }}</mat-option>
        <mat-option *ngFor="let option of optionsTariff" [value]="option.id">
          <div class="select-option-with-info">
            <span class="option-name">{{ option.serviceName }}</span>
            <span class="option-detail">{{ option.cost | currency }} - {{ option.duration }} min</span>
          </div>
        </mat-option>
      </mat-select>
      <mat-hint>{{ 'appointment.tariffHint' | translate }}</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="fill" class="input-full-width">
      <mat-label>{{ 'appointment.veterinaryLabel' | translate }}</mat-label>
      <mat-select name="veterinarianId" [(ngModel)]="appointment.veterinarianId" required>
        <mat-option [value]="0" disabled>{{ 'appointment.noSelectedVeterinary' | translate }}</mat-option>
        <mat-option *ngFor="let option of optionsVeterinarian" [value]="option.id">
          <div class="select-option-with-info">
            <span class="option-name">{{ option.fullName }}</span>
            <span class="option-detail">{{ option.veterinarianSpeciality }} - {{ option.availability }}</span>
          </div>
        </mat-option>
      </mat-select>
      <mat-hint>{{ 'appointment.veterinaryHint' | translate }}</mat-hint>
    </mat-form-field>
  </div>

  <!-- Reminder
  <div class="form-section">
    <h3 class="section-title">{{ 'appointment.reminderTitle' | translate }}</h3>

    <mat-checkbox [(ngModel)]="appointment.reminderEnabled" name="reminderEnabled">
      {{ 'appointment.enableReminder' | translate }}
    </mat-checkbox>

    <mat-form-field *ngIf="appointment.reminderEnabled" class="input-full-width reminder-field">
      <mat-label>{{ 'appointment.reminderTimeLabel' | translate }}</mat-label>
      <mat-select [(ngModel)]="appointment.reminderTime" name="reminderTime">
        <mat-option value="15">15 {{ 'appointment.minutesBefore' | translate }}</mat-option>
        <mat-option value="30">30 {{ 'appointment.minutesBefore' | translate }}</mat-option>
        <mat-option value="120">2 {{ 'appointment.hourBefore' | translate }}</mat-option>
        <mat-option value="2880">2 {{ 'appointment.dayBefore' | translate }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>-->

  <!-- A -->
  <div class="container-actions">
    <button class="button-primary"
            mat-flat-button
            type="submit"
            [disabled]="!appointmentForm.valid">
      <mat-icon>save</mat-icon>
      {{ 'appointment.addButton' | translate }}
    </button>

    <button class="button-secondary"
            mat-raised-button
            type="button"
            (click)="onCancel()">
      <mat-icon>cancel</mat-icon>
      {{ 'appointment.cancelButton' | translate }}
    </button>

    <button class="button-tertiary"
            mat-stroked-button
            type="button"
            (click)="onPreview()"
            [disabled]="!appointmentForm.valid">
      <mat-icon>preview</mat-icon>
      {{ 'appointment.previewButton' | translate }}
    </button>
  </div>

  <!-- Resumen de la cita -->
  <mat-card *ngIf="showPreview" class="appointment-summary">
    <mat-card-header>
      <mat-card-title>{{ 'appointment.summaryTitle' | translate }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="summary-item">
        <strong>{{ 'appointment.appointmentNameLabel' | translate }}:</strong> {{ appointment.appointmentName }}
      </div>
      <div class="summary-item">
        <strong>{{ 'appointment.dateTimeLabel' | translate }}:</strong>
        {{ appointment.startDateAppointment | date }} {{ appointment.startTimeAppointment }} -
        {{ appointment.endDateAppointment | date }} {{ appointment.endTimeAppointment }}
      </div>
      <div class="summary-item">
        <strong>{{ 'appointment.petLabel' | translate }}:</strong> {{ getSelectedPetName() }}
      </div>
      <div class="summary-item">
        <strong>{{ 'appointment.veterinaryLabel' | translate }}:</strong> {{ getSelectedVeterinarianName() }}
      </div>
      <div class="summary-item">
        <strong>{{ 'appointment.tariffLabel' | translate }}:</strong> {{ getSelectedTariffName() }}
      </div>
    </mat-card-content>
  </mat-card>
</form>
